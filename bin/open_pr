#!/bin/bash
set -euo pipefail
set +x

changes=$(cat "${LABELS_DIFF}")

branch="ci-${TRAVIS_BRANCH}-labels-cleanup-$(date +%Y-%m-%d-%H-%M-%S)"

curl "https://api.github.com/repos/$TRAVIS_REPO_SLUG/pulls" \
  -H "Authorization: token $GITHUB_TOKEN" \
  -X POST \
  --data @- << EOF
{
  "title": "[ci] Trimmed labels.yaml",
  "body": "Automated:\n\`\`\`$changes\`\`\`",
  "head": "$branch",
  "base": "${TRAVIS_BRANCH}"
}
EOF
